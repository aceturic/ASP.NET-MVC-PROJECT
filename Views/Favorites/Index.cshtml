@model IEnumerable<UsersApp.Models.Favorite>

<h2 class="text-center my-4 fw-bold text-primary">Your Favorites</h2>

@if (!Model.Any())
{
    <p class="text-center text-muted">You have no favorite products yet.</p>
}
else
{
    <div class="container">
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var favorite in Model)
            {
                <div class="col">
                    <div class="card h-100 shadow-sm border-0 rounded-3">
                        @if (!string.IsNullOrEmpty(favorite.Product?.ImageFileName))
                        {
                            <img src="~/products/@favorite.Product.ImageFileName" class="card-img-top" alt="@favorite.Product.Name"
                                 style="object-fit: cover; height: 200px; border-radius: 8px 8px 0 0;" />
                        }
                        else
                        {
                            <img src="~/images/placeholder.png" class="card-img-top" alt="No image available"
                                 style="object-fit: cover; height: 200px; border-radius: 8px 8px 0 0;" />
                        }

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title fw-bold">@favorite.Product?.Name</h5>
                            <p class="card-text">
                                <strong>Price:</strong>
                                <span class="text-success fw-bold">$@(favorite.Product?.Price ?? 0)</span>
                            </p>

                            <div class="mt-auto">
                                <!-- Remove Favorite Button -->
                                <button class="btn btn-danger remove-favorite-btn" data-product-id="@favorite.ProductId">
                                    <i class="fas fa-trash"></i> Remove
                                </button>

                                <!-- View Details Button -->
                                <a asp-controller="ProductDetails" asp-action="Index" asp-route-id="@favorite.ProductId"
                                   class="btn btn-outline-secondary mt-2">
                                    <i class="fas fa-info-circle"></i> View Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".remove-favorite-btn").forEach(button => {
                button.addEventListener("click", function () {
                    let productId = this.getAttribute("data-product-id");

                    fetch(`/Favorites/RemoveFromFavorites?productId=${productId}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload(); // ✅ Reload page after removing favorite
                        } else {
                            alert(data.message);
                        }
                    })
                    .catch(error => console.error("Error:", error));
                });
            });
        });
    </script>
}
